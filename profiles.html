<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Mentors & Mentees</title>
  <link rel="stylesheet" href="profiles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <meta name="description"
    content="Mentors & Mentees is a platform for mentors to connect with mentees and vice versa.">
</head>


<body>
  <!-- Request Popup Display------------------------------------------------------------------------------------------------- -->
  <div class="popup" id="popup">
    <div class="request">
        <div class="user-info">
          <img src="profile_picutre.png" alt="Profile Picture">
          <h3>Username</h3>
          <button class="profile-btn" id="profile-bulb" onclick="viewProfile()">View Profile</button>
        </div>
      <div class="request-buttons">
        <button class="accept-btn" onclick="acceptRequest()">Accept</button>
        <button class="deny-btn" onclick="denyRequest()">Deny</button>
      </div>
    </div>

    <div class="request">
      <div class="user-info">
        <img src="profile_picutre.png" alt="Profile Picture">
        <h3>Username</h3>
        <button class="profile-btn" onclick="viewProfile()">View Profile</button>
      </div>
      <div class="request-buttons">
        <button class="accept-btn" onclick="acceptRequest()">Accept</button>
        <button class="deny-btn" onclick="denyRequest()">Deny</button>
      </div>
    </div> 

    <button type="button" class="btn" onclick="closePopup()">Back</button>
  </div>

  <!-- Popup Profiles -->
  <div class="popup-profiles-list" id="popup-profiles-list">
    <div class="popup-profile" id="popup-profile">
      <div class="video" data-tags="python, thursday, mentor">
        <div class="thumbnail">
          <a href="https://www.linkedin.com/" target="_blank"><img src="img/video1.jpg" alt="thumbnail"></a>
        </div>
        <h2 class="videoTitle">Jane Doe</h2>
        <p>Mentor</p>

        <span class="tag">Python</span><span class="tag">Thursdays</span>
      </div>
      <button type="button" class="btn" id="sendRequestBtn" onclick="sendRequest()">Send Request</button>
      <button type="button" class="btn" onclick="closeProfile()">Back</button>
    </div>
  </div>

  <div id="wrapper">
    <!-- Nav Bar --->
    <nav>
      <ul>
        <li><a href="index.html">Logout</a></li>
        <li class="accounts-btn"><a href="account.html">Account</a></li>
        <li><a href="profiles.html">Home</a></li>
        <li><a href="#" onclick="openPopup()">Requests</a></li>
      </ul>
    </nav>

    <!-- Hero Image -->
      <div id="homehero">
        <div id="homehero-text">
          <h1>Mentors & Mentees</h1>
        </div>
        <div id="homehero-subtext">
          <h2>A better platform for making genuine connections</h2>
        </div>
      </div>
    </header>

    <!-- Main Body -->
    <main>
      <h2 class="line">Explore</h2>
      <div id="container">
        <input type="text" maxlength="50" id="searchInput" placeholder="Search by Name">
        <div align="center">
          <label class="filterCheckboxes" for="filterCheckboxes">Filter by Category:</label>
          <div class="filterCheckboxes">
            <div class="category">
              <h3>Mentor or Mentee</h3>
              <input type="checkbox" id="mentorCheckbox" value="mentor">
              <label for="mentorCheckbox">Mentor</label><br>
              <input type="checkbox" id="menteeCheckbox" value="mentee">
              <label for="menteeCheckbox">Mentee</label><br>
            </div>
            <div class="category">
              <h3>Work Style</h3>
              <input type="checkbox" id="collabCheckbox" value="collab">
              <label for="collabCheckbox">Collaborative</label><br>
              <input type="checkbox" id="independentCheckbox" value="independent">
              <label for="independentCheckbox">Independent</label><br>
              <input type="checkbox" id="adaptiveCheckbox" value="adaptive">
              <label for="adaptiveCheckbox">Adaptive</label><br>
              <input type="checkbox" id="structuredCheckbox" value="structured">
              <label for="structuredCheckbox">Structured</label><br>
              <input type="checkbox" id="flexibleCheckbox" value="flexible">
              <label for="flexibleCheckbox">Flexible</label><br>
              <input type="checkbox" id="proximityCheckbox" value="proximity">
              <label for="proximityCheckbox">Proximity</label><br><br>
            </div>
            <div class="category">
              <h3>Languages</h3>
              <input type="checkbox" id="pythonCheckbox" value="python">
              <label for="pythonCheckbox">Python</label><br>
              <input type="checkbox" id="jsCheckbox" value="js">
              <label for="jsCheckbox">JavaScript</label><br>
              <input type="checkbox" id="htmlCheckbox" value="html">
              <label for="htmlCheckbox">HTML5</label><br>
              <input type="checkbox" id="cssCheckbox" value="css">
              <label for="cssCheckbox">CSS</label><br>
              <input type="checkbox" id="sqlCheckbox" value="sql">
              <label for="sqlCheckbox">SQL</label><br>
              <input type="checkbox" id="javaCheckbox" value="java">
              <label for="javaCheckbox">Java</label><br>
            </div>
            <div class="category">
              <h3>Traits</h3>
              <input type="checkbox" id="friendlyCheckbox" value="friendly">
              <label for="friendlyCheckbox">Friendly</label><br>
              <input type="checkbox" id="formalCheckbox" value="formal">
              <label for="formalCheckbox">Formal</label><br>
              <input type="checkbox" id="honestCheckbox" value="honest">
              <label for="honestCheckbox">Honest</label><br>
            </div>
            <div class="category">
              <h3>Availability</h3>
              <input type="checkbox" id="mondayCheckbox" value="mondays">
              <label for="mondayCheckbox">Mondays</label><br>
              <input type="checkbox" id="tuesdayCheckbox" value="tuesdays">
              <label for="tuesdayCheckbox">Tuesdays</label><br>
              <input type="checkbox" id="wednesdayCheckbox" value="wednesdays">
              <label for="wednesdayCheckbox">Wednesdays</label><br>
              <input type="checkbox" id="thursdayCheckbox" value="thursdays">
              <label for="thursdayCheckbox">Thursdays</label><br>
              <input type="checkbox" id="fridayCheckbox" value="fridays">
              <label for="fridayCheckbox">Fridays</label><br>
              <input type="checkbox" id="weekendsCheckbox" value="weekends">
              <label for="weekendsCheckbox">Weekends</label><br>
            </div>
            <div class="category">
              <h3>Location</h3>
              <input type="checkbox" id="zoomCheckbox" value="zoom">
              <label for="zoomCheckbox">Zoom </label><br>
              <input type="checkbox" id="inofficeCheckbox" value="office">
              <label for="inofficeCheckbox">In-Office </label><br>
              <input type="checkbox" id="nonofficeCheckbox" value="non-office">
              <label for="nonofficeCheckbox">Non-Office </label><br>
            </div>
            <!-- Add more categories as needed -->
          </div>
        </div>
      </div>

      <!-- Profile List -->
      <div class="collection-list">
        <div id="profile-container" class="profile-container">
          <!-- Profile cards will be appended here -->
        </div>
      </div>
      
   
    

      <div class="collection-list">
        <!-- <div class="video" data-tags="python, thursday, mentor">
          <div class="thumbnail">
            <a href="https://www.linkedin.com/" target="_blank"><img src="img/video1.jpg" alt="thumbnail"></a>
          </div>
          <h2 class="videoTitle">Jane Doe</h2>
          <p>Mentor</p>

          <span class="tag">Python</span><span class="tag">Thursdays</span>
        </div>
        <div class="video" data-tags="friendly">
          <div class="thumbnail">
            <a href="https://www.linkedin.com/" target="_blank"><img src="img/video1.jpg" alt="thumbnail"></a>
          </div>
          <h2>John Smith</h2>
          <p>Mentee</p>

          <span class="tag">Friendly</span>
        </div>
        <div class="video" data-tags="zoom, python">
          <div class="thumbnail">
            <a href="https://www.linkedin.com/in/liam-hollander/"><img src="img/video3.jpg" alt="thumbnail"></a>
          </div>
          <h2>Kim Kardashian</h2>
          <p>Mentee</p>

          <span class="tag">Zoom</span><span class="tag">Python</span>
        </div>
        <div class="video" data-tags="thursday, friendly">
          <div class="thumbnail">
            <a href="https://www.linkedin.com/in/liam-hollander/"><img src="img/video4.jpg" ></a>
          </div>
          <h2>Another name idk</h2>
          <p>Mentor</p>

          <span class="tag">Thursdays</span><span class="tag">Friendly</span>
        </div> -->

      </div>
    </main>
    <footer>
      <p>Copyright Â© 2024 Penguins<br> </p>
    </footer>
  </div>
  <script src="script.js"></script>
  <script src="https://kit.fontawesome.com/cae0f22046.js" crossorigin="anonymous"></script>
  <script>
    const sendRequestBtn = document.getElementById("sendRequestBtn");

function sendRequest() {
  const recipientUserID = sendRequestBtn.dataset.recipientUserID;
  console.log('recipientUserID:', recipientUserID);
  // Send an AJAX request to the server
  fetch('/send-request', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ recipientUserID: sendRequestBtn.dataset.recipientUserID }),

  })
    .then(response => {
      if (response.ok) {
        // Handle the successful response (e.g., display a success message)
        console.log('Request sent successfully');
      } else {
        // Handle the error response
        console.error('Failed to send request');
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
}

    // Pop Up Handlers-------------------------------------------------------------------------------------------------------------------------------------
    let profile = document.getElementById("popup-profile")
    let isActive = false;

    function openProfile(recipientUserID) {
      profile.classList.add("open-popup");
      document.getElementById("wrapper").classList.add("popup-opened");
      sendRequestBtn.dataset.recipientUserID = recipientUserID;
    }
    function closeProfile() {
      if (!isActive) {
        profile.classList.remove("open-popup");
        document.getElementById("wrapper").classList.remove("popup-opened");
        console.log('false')

      } else {
        profile.classList.remove("open-popup");
        popup.classList.remove("opacity");
        popup.classList.add("open-popup");
        document.getElementById("wrapper").classList.add("popup-opened");
      }
    }

    let popup = document.getElementById("popup");

    function openPopup() {
  isActive = true;
  popup.classList.add('open-popup');
  document.getElementById('wrapper').classList.add('popup-opened');
  sendRequestBtn.style.display = 'none';
  console.log('this is now true');

  // Fetch the list of friend requests for the logged-in user from the server
  fetch('/get-friend-requests')
    .then((response) => response.json())
    .then((requests) => {
      // Clear the existing requests in the popup
      popup.innerHTML = '';

      // Populate the popup with the list of friend requests
      requests.forEach((request) => {
        const requestElement = document.createElement('div');
        
        requestElement.classList.add('video');
        requestElement.innerHTML = `
          <div class="request">
            <div class="user-info">
              <h3>${request.senderUsername}</h3>
              <button class="profile-btn" onclick="viewProfile('${request.senderUserID}')">View Profile</button>
            </div>
            <div class="request-buttons">
              <button class="accept-btn" onclick="acceptRequest('${request.requestID}')">Accept</button>
              <button class="deny-btn" onclick="denyRequest('${request.requestID}')">Deny</button>
            </div>
          </div>
          <button type="button" class="btn" onclick="closePopup()">Back</button>
        `;
        popup.appendChild(requestElement);
      });
    })
    .catch((error) => {
      console.error('Error fetching friend requests:', error);
    });
}
    function closePopup() {
      isActive = false;
      popup.classList.remove("open-popup");
      document.getElementById("wrapper").classList.remove("popup-opened");
      console.log('this is now false')
      sendRequestBtn.style.display = "block";
    }
    function viewProfile() {
      profile.classList.add("open-popup");
      popup.classList.add("opacity");
      document.getElementById("wrapper").classList.add("popup-opened");
    }



    // Adding Profiles onto page-------------------------------------------------------------------------------------------------------------------------
    document.addEventListener("DOMContentLoaded", function () {
  // Fetch user profiles from the server
  fetch('/profiles')
    .then(response => response.json())
    .then(profiles => {
      // Generate profile cards based on the retrieved profiles
      const profileContainer = document.getElementById('profile-container');

      profiles.forEach(profile => {
        const profileCard = document.createElement('div');
        profileCard.classList.add('video');
        profileCard.setAttribute('data-tags', profile.tags ? profile.tags.join(', ') : ''); // Add a check for the existence of 'tags'

        // Function to convert boolean values to tags
        const booleanToTag = (key, value) => value ? `<span class="tag">${key}</span>` : '';

        // Function to capitalize the first letter of a string
        const capitalize = (str) => str.charAt(0).toUpperCase() + str.slice(1);

        // Customize the profile card based on profile data
        profileCard.innerHTML = `
          <a href="javascript:void(0)" onclick="openProfile()">
            <!-- <div class="thumbnail">
            <img src="/path/to/profile/picture" alt="Profile Picture">
          </div> -->
          <h2 class="videoTitle">${profile.first_name} ${profile.last_name}</h2>
          <p class="mentor-mentee">${capitalize(profile.user_type)}</p>
          <div class="tags">
            ${profile.strengths ? profile.strengths.map(strength => `<span class="tag">${strength}</span>`).join('') : ''}
            ${booleanToTag('Zoom', profile.zoom)}
            ${booleanToTag('Office', profile.office)}
            ${booleanToTag('Non-office', profile.nonoffice)}
            ${booleanToTag('Mondays', profile.mondayCheckbox)}
            ${booleanToTag('Tuesdays', profile.tuesdayCheckbox)}
            ${booleanToTag('Wednesdays', profile.wednesdayCheckbox)}
            ${booleanToTag('Thursdays', profile.thursdayCheckbox)}
            ${booleanToTag('Fridays', profile.fridayCheckbox)}
            ${booleanToTag('Weekends', profile.weekendsCheckbox)}
          </div>
          </a>
        `;

         // Add click event listener to open the popup
         profileCard.addEventListener('click', () => {
              // Update the content of the popup
              const recipientUserID = profile.userID;
              const popup = document.getElementById('popup-profile');
              popup.innerHTML = `
              <div class="video" data-tags="${profile.tags ? profile.tags.join(', ') : ''}" data-userid="${profile.userID}">
  <!-- <div class="thumbnail"> <img src="/path/to/profile/picture" alt="Profile Picture"> </div> -->
  <h2 class="videoTitle">${profile.first_name} ${profile.last_name}</h2>
  <p>${capitalize(profile.user_type)}</p>
  <div class="profile-details">
    <div class="detail-item">
      <div class="detail-title">Role</div>
      <div class="detail-value">${profile.role}</div>
    </div>
    <div class="detail-item">
      <div class="detail-title">LinkedIn</div>
      <div class="detail-value"><a href="${profile.linkedin}" target="_blank">${profile.linkedin}</a></div>
    </div>
    <div class="detail-item">
      <div class="detail-title">Work Style</div>
      <div class="detail-value">${profile.workstyle}</div>
    </div>
    <div class="detail-item">
      <div class="detail-title">Strengths</div>
      <div class="detail-value">${profile.strengths.join(', ')}</div>
    </div>
    <div class="detail-item">
      <div class="detail-title">Weaknesses</div>
      <div class="detail-value">${profile.weaknesses}</div>
    </div>
    <div class="detail-item">
      <div class="detail-title">Personality Traits</div>
      <div class="detail-value">${profile.personality_traits.join(', ')}</div>
    </div>
    <div class="detail-item">
      <div class="detail-title">Question 1</div>
      <div class="detail-value">
        <p><strong>${profile.questionSelection1}</strong></p>
        <p>${profile.questions1}</p>
      </div>
    </div>
    <div class="detail-item">
      <div class="detail-title">Question 2</div>
      <div class="detail-value">
        <p><strong>${profile.questionSelection2}</strong></p>
        <p>${profile.questions2}</p>
      </div>
    </div>
    <div class="detail-item">
      <div class="detail-title">Availability</div>
      <div class="detail-value">${profile.availability}</div>
    </div>
  </div>
</div>
<button type="button" class="btn" id="sendRequestBtn" onclick="sendRequest()">Send Request</button>
<button type="button" class="btn" onclick="closeProfile()">Back</button>
              `;

              // Open the popup
              openProfile(recipientUserID);
            });

        // Append the profile card to the container
        profileContainer.appendChild(profileCard);
      });
    })
    .catch(error => {
      console.error('Error fetching profiles:', error);
    });
});


  </script>
</body>

</html>